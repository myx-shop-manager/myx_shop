name: CI/CD Pipeline

on:
  push:
    branches: [ main, master ]
  pull_request:
    branches: [ main, master ]
  schedule:
    # æ¯å¤© UTC 00:00 é‹è¡Œä¸€æ¬¡
    - cron: '0 0 * * *'

jobs:
  test:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v3
      
    - name: HTML Validation
      run: |
        echo "æª¢æŸ¥ HTML æ–‡ä»¶..."
        # å®‰è£ html5validator
        pip install html5validator
        # æª¢æŸ¥ä¸»è¦ HTML æ–‡ä»¶
        html5validator --root . --match "*.html" --ignore "admin/*" || true
        
    - name: Check GA4 Code
      run: |
        echo "æª¢æŸ¥ GA4 ä»£ç¢¼..."
        if grep -r "G-RX7R4JWV7E" index.html; then
          echo "âœ… GA4 æ¸¬é‡ ID å­˜åœ¨"
        else
          echo "âŒ GA4 æ¸¬é‡ ID æœªæ‰¾åˆ°"
          exit 1
        fi
        
  deploy:
    runs-on: ubuntu-latest
    needs: test  # ä¾è³´ test job æˆåŠŸ
    if: github.ref == 'refs/heads/main'
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v3
      
    - name: Setup Pages
      uses: actions/configure-pages@v3
      
    - name: Build (å¦‚æœéœ€è¦)
      run: |
        echo "æ§‹å»ºæ­¥é©Ÿ..."
        # é€™è£¡å¯ä»¥æ·»åŠ æ§‹å»ºå‘½ä»¤ï¼Œå¦‚ï¼š
        # npm install
        # npm run build
        
    - name: Upload artifact
      uses: actions/upload-pages-artifact@v2
      with:
        path: '.'
        
    - name: Deploy to GitHub Pages
      id: deployment
      uses: actions/deploy-pages@v2
      
    - name: Send notification
      if: success()
      run: |
        echo "ğŸš€ éƒ¨ç½²æˆåŠŸï¼"
        echo "ç¶²ç«™ URL: https://myx-shop-manager.github.io/myx_shop/"
        
    - name: Notify on failure
      if: failure()
      run: |
        echo "âŒ éƒ¨ç½²å¤±æ•—ï¼è«‹æª¢æŸ¥éŒ¯èª¤ã€‚"
