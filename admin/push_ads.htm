<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>PushAds Pro - è¥é”€åŠ©æ‰‹</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #25D366;
            --primary-dark: #128C7E;
            --secondary: #667eea;
            --danger: #F44336;
            --warning: #FF9800;
            --success: #4CAF50;
            --dark: #075E54;
            --light: #f0f2f5;
            --card: #ffffff;
            --text: #333333;
            --text-light: #666666;
            --border: #e0e0e0;
            --shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        @media (prefers-color-scheme: dark) {
            :root {
                --light: #0b141a;
                --card: #1e2a38;
                --text: #e4e6eb;
                --text-light: #a0a6b1;
                --border: #2a3849;
                --shadow: 0 2px 10px rgba(0,0,0,0.3);
            }
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--light);
            color: var(--text);
            line-height: 1.5;
            font-size: 16px;
            padding-bottom: 80px;
        }

        .header {
            background: linear-gradient(135deg, var(--dark), var(--primary-dark));
            color: white;
            padding: 15px;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: var(--shadow);
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .app-title {
            font-size: 20px;
            font-weight: bold;
        }

        .app-subtitle {
            font-size: 12px;
            opacity: 0.9;
        }

        .header-btn {
            background: rgba(255,255,255,0.2);
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            color: white;
            font-size: 18px;
            cursor: pointer;
        }

        .category-tabs {
            display: flex;
            overflow-x: auto;
            padding: 10px 15px;
            background: var(--card);
            gap: 8px;
            position: sticky;
            top: 70px;
            z-index: 90;
        }

        .category-tabs::-webkit-scrollbar {
            display: none;
        }

        .category-tab {
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 14px;
            background: var(--light);
            color: var(--text);
            border: 1px solid var(--border);
            cursor: pointer;
            white-space: nowrap;
            flex-shrink: 0;
        }

        .category-tab.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        .stats-container {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            padding: 15px;
        }

        .stat-card {
            background: var(--card);
            border-radius: 12px;
            padding: 15px;
            text-align: center;
            box-shadow: var(--shadow);
        }

        .stat-value {
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 12px;
            color: var(--text-light);
        }

        .main-content {
            padding: 0 15px 15px;
        }

        .message-config {
            background: var(--card);
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 20px;
            box-shadow: var(--shadow);
        }

        .section-title {
            font-size: 18px;
            font-weight: bold;
            margin: 15px 0 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn-small {
            padding: 6px 12px;
            font-size: 12px;
        }

        .btn-secondary {
            background: var(--secondary);
        }

        .drop-zone {
            border: 2px dashed var(--primary);
            border-radius: 12px;
            padding: 30px 20px;
            text-align: center;
            background: rgba(37, 211, 102, 0.05);
            margin: 15px 0;
            cursor: pointer;
        }

        .drop-zone-icon {
            font-size: 40px;
            color: var(--primary);
            margin-bottom: 10px;
        }

        .drop-zone-text {
            font-size: 16px;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .drop-zone-subtext {
            font-size: 14px;
            color: var(--text-light);
        }

        select {
            width: 100%;
            padding: 12px;
            border: 1px solid var(--border);
            border-radius: 8px;
            background: var(--card);
            color: var(--text);
            font-size: 16px;
            margin-bottom: 15px;
            cursor: pointer;
        }

        .message-preview {
            background: var(--light);
            border-radius: 8px;
            padding: 15px;
            font-size: 14px;
            line-height: 1.6;
            max-height: 200px;
            overflow-y: auto;
            border-left: 4px solid var(--primary);
            white-space: pre-line;
        }

        .btn-group {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .btn-group .btn {
            flex: 1;
        }

        .customer-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .customer-card {
            background: var(--card);
            border-radius: 12px;
            padding: 15px;
            box-shadow: var(--shadow);
            border-left: 4px solid var(--primary);
        }

        .customer-header {
            display: flex;
            align-items: flex-start;
            margin-bottom: 10px;
        }

        .customer-avatar {
            width: 60px;
            height: 60px;
            border-radius: 10px;
            background: var(--primary);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 20px;
            font-weight: bold;
            margin-right: 12px;
            position: relative;
            overflow: hidden;
            flex-shrink: 0;
        }

        .customer-avatar-img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .customer-info {
            flex: 1;
        }

        .customer-name {
            font-weight: bold;
            font-size: 16px;
            margin-bottom: 5px;
        }

        .customer-phone {
            color: var(--primary);
            font-size: 14px;
            margin-bottom: 5px;
        }

        .customer-notes {
            background: var(--light);
            padding: 10px;
            border-radius: 8px;
            font-size: 14px;
            margin: 10px 0;
        }

        .customer-photos {
            display: flex;
            gap: 10px;
            margin: 10px 0;
            flex-wrap: wrap;
        }

        .customer-photo {
            width: 80px;
            height: 80px;
            border-radius: 8px;
            object-fit: cover;
            cursor: pointer;
            border: 2px solid var(--border);
        }

        .customer-photo:hover {
            border-color: var(--primary);
        }

        .customer-actions {
            display: flex;
            gap: 8px;
            margin-top: 15px;
        }

        .action-btn {
            flex: 1;
            padding: 10px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
        }

        .send-btn {
            background: var(--primary);
            color: white;
        }

        .edit-btn {
            background: var(--secondary);
            color: white;
        }

        .delete-btn {
            background: var(--danger);
            color: white;
        }

        .filter-buttons {
            display: flex;
            gap: 8px;
            margin: 10px 0;
            overflow-x: auto;
            padding: 5px 0;
        }

        .filter-btn {
            padding: 8px 16px;
            border: 1px solid var(--border);
            border-radius: 20px;
            background: var(--light);
            color: var(--text);
            font-size: 14px;
            cursor: pointer;
            white-space: nowrap;
            flex-shrink: 0;
        }

        .filter-btn.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: var(--card);
            display: flex;
            justify-content: space-around;
            padding: 12px 0;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
            z-index: 100;
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            color: var(--text-light);
            font-size: 12px;
            cursor: pointer;
            padding: 8px;
        }

        .nav-item.active {
            color: var(--primary);
        }

        .nav-icon {
            font-size: 20px;
        }

        .modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.7);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            padding: 20px;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: var(--card);
            border-radius: 16px;
            padding: 20px;
            width: 100%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-title {
            font-size: 20px;
            font-weight: bold;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 24px;
            color: var(--text-light);
            cursor: pointer;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            font-size: 14px;
        }

        input, textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid var(--border);
            border-radius: 8px;
            background: var(--card);
            color: var(--text);
            font-size: 16px;
        }

        textarea {
            min-height: 100px;
            resize: vertical;
        }

        .photo-upload-area {
            border: 2px dashed var(--border);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            margin-bottom: 15px;
            transition: all 0.3s;
        }

        .photo-upload-area:hover {
            border-color: var(--primary);
            background: rgba(37, 211, 102, 0.05);
        }

        .photo-upload-icon {
            font-size: 40px;
            color: var(--text-light);
            margin-bottom: 10px;
        }

        .photo-preview-container {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 15px;
        }

        .photo-preview {
            width: 100px;
            height: 100px;
            border-radius: 8px;
            object-fit: cover;
            position: relative;
        }

        .photo-preview img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 8px;
        }

        .photo-remove {
            position: absolute;
            top: -8px;
            right: -8px;
            background: var(--danger);
            color: white;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            cursor: pointer;
            border: 2px solid var(--card);
        }

        .form-actions {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 12px 20px;
            border-radius: 8px;
            color: white;
            font-weight: bold;
            z-index: 1100;
            animation: slideIn 0.3s ease;
        }

        .notification.success {
            background: var(--success);
        }

        .notification.error {
            background: var(--danger);
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--text-light);
        }

        .empty-icon {
            font-size: 60px;
            margin-bottom: 20px;
            opacity: 0.5;
        }

        .loading {
            text-align: center;
            padding: 40px 20px;
            color: var(--text-light);
        }

        .loading i {
            margin-right: 10px;
        }

        .photo-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.9);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1200;
            padding: 20px;
        }

        .photo-modal.active {
            display: flex;
        }

        .photo-modal-content {
            position: relative;
            max-width: 90%;
            max-height: 90%;
        }

        .photo-modal-img {
            max-width: 100%;
            max-height: 80vh;
            object-fit: contain;
            border-radius: 8px;
        }

        .photo-modal-close {
            position: absolute;
            top: -20px;
            right: -20px;
            background: var(--danger);
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            cursor: pointer;
            border: 2px solid white;
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
    </style>
</head>
<body>
    <!-- é¡¶éƒ¨æ  -->
    <div class="header">
        <div class="header-content">
            <div>
                <div class="app-title">PushAds Pro</div>
                <div class="app-subtitle">è¥é”€åŠ©æ‰‹</div>
            </div>
            <div>
                <button class="header-btn" onclick="exportData()">
                    <i class="fas fa-download"></i>
                </button>
            </div>
        </div>
    </div>

    <!-- ç±»åˆ«æ ‡ç­¾ -->
    <div class="category-tabs">
        <button class="category-tab active" onclick="setCategory('general')">ç»¼åˆ</button>
        <button class="category-tab" onclick="setCategory('ai-stock')">AIé€‰è‚¡</button>
        <button class="category-tab" onclick="setCategory('alliance-shop')">è”ç›Ÿå•†åº—</button>
        <button class="category-tab" onclick="setCategory('used-car')">äºŒæ‰‹è½¦è¾†</button>
        <button class="category-tab" onclick="setCategory('property')">æˆ¿åœ°äº§</button>
    </div>

    <!-- ç»Ÿè®¡å¡ç‰‡ -->
    <div class="stats-container">
        <div class="stat-card">
            <div class="stat-value" id="totalCustomers">0</div>
            <div class="stat-label">æ€»å®¢æˆ·</div>
        </div>
        <div class="stat-card">
            <div class="stat-value" id="pendingCustomers">0</div>
            <div class="stat-label">å¾…å‘é€</div>
        </div>
        <div class="stat-card">
            <div class="stat-value" id="sentToday">0</div>
            <div class="stat-label">ä»Šæ—¥å·²å‘</div>
        </div>
        <div class="stat-card">
            <div class="stat-value" id="totalMessages">0</div>
            <div class="stat-label">æ¶ˆæ¯æ¨¡æ¿</div>
        </div>
    </div>

    <!-- ä¸»å†…å®¹åŒº -->
    <div class="main-content">
        <!-- æ¶ˆæ¯é…ç½® -->
        <div class="message-config">
            <h3 style="margin-bottom: 15px; font-size: 18px;">æ¶ˆæ¯é…ç½®</h3>
            
            <!-- æ‹–æ”¾åŒº -->
            <div class="drop-zone" id="dropZone" onclick="importMessages()">
                <div class="drop-zone-icon">
                    <i class="fas fa-cloud-upload-alt"></i>
                </div>
                <div class="drop-zone-text">ç‚¹å‡»å¯¼å…¥æ¶ˆæ¯æ¨¡æ¿</div>
                <div class="drop-zone-subtext">æˆ–æ‹–æ”¾ messages.json æ–‡ä»¶</div>
            </div>
            
            <!-- æ–‡ä»¶ä¿¡æ¯ -->
            <div id="fileInfo" style="display: none; background: var(--light); padding: 15px; border-radius: 8px; margin: 15px 0;">
                <div id="fileInfoContent"></div>
                <div style="display: flex; gap: 10px; margin-top: 15px;">
                    <button class="btn" onclick="confirmImport()" style="flex: 1;">ç¡®è®¤å¯¼å…¥</button>
                    <button class="btn btn-secondary" onclick="cancelImport()" style="flex: 1;">å–æ¶ˆ</button>
                </div>
            </div>
            
            <!-- æ¶ˆæ¯é€‰æ‹© -->
            <select id="messageCategory" onchange="loadTemplates()">
                <option value="">é€‰æ‹©æ¶ˆæ¯ç±»åˆ«</option>
                <option value="general">ç»¼åˆ</option>
                <option value="ai-stock">AIé€‰è‚¡</option>
                <option value="alliance-shop">è”ç›Ÿå•†åº—</option>
                <option value="used-car">äºŒæ‰‹è½¦è¾†</option>
                <option value="property">æˆ¿åœ°äº§</option>
            </select>
            
            <select id="messageTemplate" onchange="showPreview()">
                <option value="">é€‰æ‹©æ¶ˆæ¯æ¨¡æ¿</option>
            </select>
            
            <!-- æ¶ˆæ¯é¢„è§ˆ -->
            <div class="message-preview" id="messagePreview">
                è¯·é€‰æ‹©æ¶ˆæ¯æ¨¡æ¿æŸ¥çœ‹é¢„è§ˆ
            </div>
            
            <!-- æŒ‰é’®ç»„ -->
            <div class="btn-group">
                <button class="btn" onclick="sendToAll()">
                    <i class="fas fa-paper-plane"></i> å‘é€ç»™æ‰€æœ‰å®¢æˆ·
                </button>
                <button class="btn btn-secondary" onclick="testMessage()">
                    <i class="fas fa-vial"></i> æµ‹è¯•å‘é€
                </button>
            </div>
        </div>

        <!-- å®¢æˆ·ç®¡ç† -->
        <div class="section-title">
            å®¢æˆ·ç®¡ç†
            <button class="btn" onclick="openAddModal()">
                <i class="fas fa-plus"></i> æ·»åŠ å®¢æˆ·
            </button>
        </div>

        <!-- ç­›é€‰æŒ‰é’® -->
        <div class="filter-buttons">
            <button class="filter-btn active" onclick="setFilter('all')">å…¨éƒ¨</button>
            <button class="filter-btn" onclick="setFilter('pending')">å¾…å‘é€</button>
            <button class="filter-btn" onclick="setFilter('sent')">å·²å‘é€</button>
            <button class="filter-btn" onclick="setFilter('today')">ä»Šæ—¥æ–°å¢</button>
            <button class="filter-btn" onclick="setFilter('hasPhotos')">æœ‰ç…§ç‰‡</button>
        </div>

        <!-- å®¢æˆ·åˆ—è¡¨ -->
        <div class="customer-list" id="customerList">
            <div class="loading">
                <i class="fas fa-spinner fa-spin"></i> åŠ è½½ä¸­...
            </div>
        </div>
    </div>

    <!-- åº•éƒ¨å¯¼èˆª -->
    <div class="bottom-nav">
        <div class="nav-item active" onclick="showTab('home')">
            <i class="fas fa-home nav-icon"></i>
            <span>é¦–é¡µ</span>
        </div>
        <div class="nav-item" onclick="showTab('customers')">
            <i class="fas fa-users nav-icon"></i>
            <span>å®¢æˆ·</span>
        </div>
        <div class="nav-item" onclick="showTab('messages')">
            <i class="fas fa-comments nav-icon"></i>
            <span>æ¶ˆæ¯</span>
        </div>
        <div class="nav-item" onclick="showTab('stats')">
            <i class="fas fa-chart-bar nav-icon"></i>
            <span>ç»Ÿè®¡</span>
        </div>
    </div>

    <!-- æ·»åŠ å®¢æˆ·æ¨¡æ€æ¡† -->
    <div class="modal" id="addModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="modalTitle">æ·»åŠ æ–°å®¢æˆ·</h3>
                <button class="close-btn" onclick="closeModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <form onsubmit="saveCustomer(event)">
                <div class="form-group">
                    <label class="form-label">å§“å *</label>
                    <input type="text" id="customerName" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label">ç”µè¯å·ç  *</label>
                    <input type="tel" id="customerPhone" required placeholder="+60 12-345 6789">
                </div>
                
                <div class="form-group">
                    <label class="form-label">å®¢æˆ·ç±»åˆ« *</label>
                    <select id="customerCategory" required>
                        <option value="general">ç»¼åˆ</option>
                        <option value="ai-stock">AIé€‰è‚¡</option>
                        <option value="alliance-shop">è”ç›Ÿå•†åº—</option>
                        <option value="used-car">äºŒæ‰‹è½¦è¾†</option>
                        <option value="property">æˆ¿åœ°äº§</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label class="form-label">å®¢æˆ·ç…§ç‰‡</label>
                    <div class="photo-upload-area" onclick="document.getElementById('photoInput').click()">
                        <div class="photo-upload-icon">
                            <i class="fas fa-camera"></i>
                        </div>
                        <div>ç‚¹å‡»ä¸Šä¼ ç…§ç‰‡</div>
                        <div style="font-size: 12px; color: var(--text-light); margin-top: 5px;">
                            æ”¯æŒ JPGã€PNG æ ¼å¼
                        </div>
                    </div>
                    <input type="file" id="photoInput" accept="image/*" multiple style="display: none;" onchange="handlePhotos(event)">
                    
                    <!-- ç…§ç‰‡é¢„è§ˆåŒº -->
                    <div class="photo-preview-container" id="photoPreview"></div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">æ„Ÿå…´è¶£äº§å“</label>
                    <input type="text" id="customerProduct" placeholder="ä¾‹å¦‚: iPhone 15">
                </div>
                
                <div class="form-group">
                    <label class="form-label">å¤‡æ³¨</label>
                    <textarea id="customerNotes" placeholder="æ·»åŠ å¤‡æ³¨..." rows="3"></textarea>
                </div>
                
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeModal()" style="flex: 1;">å–æ¶ˆ</button>
                    <button type="submit" class="btn" style="flex: 1;">ä¿å­˜</button>
                </div>
            </form>
        </div>
    </div>

    <!-- ç…§ç‰‡æŸ¥çœ‹æ¨¡æ€æ¡† -->
    <div class="photo-modal" id="photoModal" onclick="closePhotoModal()">
        <div class="photo-modal-content" onclick="event.stopPropagation()">
            <img id="photoModalImg" class="photo-modal-img" src="" alt="ç…§ç‰‡é¢„è§ˆ">
            <button class="photo-modal-close" onclick="closePhotoModal()">
                <i class="fas fa-times"></i>
            </button>
        </div>
    </div>

    <script>
        // å…¨å±€å˜é‡
        let customers = [];
        let messages = { messages: [] };
        let currentCategory = 'general';
        let currentFilter = 'all';
        let editingId = null;
        let fileData = null;
        let currentPhotos = []; // å½“å‰ä¸Šä¼ çš„ç…§ç‰‡
        
        // é»˜è®¤æ¶ˆæ¯
        const defaultMessages = {
            "messages": [
                {
                    "id": "msg_general_01",
                    "category": "general",
                    "title": "ç»¼åˆæœåŠ¡ä»‹ç»",
                    "text": "ğŸ›ï¸ æ‚¨å¥½ï¼\n\nå‘ç°æ‚¨å¯¹ä¼˜è´¨äº§å“å¾ˆæœ‰å“å‘³ï¼MyxShopä¸ºæ‚¨ç²¾é€‰ï¼š\n\nğŸ å¥åº·é£Ÿå“ä¸ä¿å¥ç”¨å“\nğŸ  å®¶å±…ç”Ÿæ´»å¿…éœ€å“  \nğŸ’„ ç¾å¦†æŠ¤è‚¤ç²¾å“\nğŸ“± ç”µå­æ™ºèƒ½è®¾å¤‡\n\nâœ¨ æ‰€æœ‰äº§å“æä¾›ï¼š\nâœ… é©¬æ¥è¥¿äºšæ­£å“ä¿è¯\nâœ… æœ€ä¼˜æƒ ä»·æ ¼ä¿è¯\nâœ… å…¨é©¬å¿«é€Ÿé…é€\nâœ… ä¸“ä¸šå”®åæœåŠ¡\n\nç«‹å³æµè§ˆé€‰è´­ï¼š https://example.com\n\næ–°å®¢ä¸“äº«ï¼šé¦–æ¬¡ä¸‹å•äº«95æŠ˜ä¼˜æƒ ï¼"
                },
                {
                    "id": "msg_ai_stock_01",
                    "category": "ai-stock",
                    "title": "Bursa AIé€‰è‚¡ä¸“ä¸šç‰ˆ",
                    "text": "ğŸ“ˆ æ‚¨å¥½ï¼\n\nå‘ç°æ‚¨å¯¹é©¬æ¥è¥¿äºšè‚¡å¸‚(Bursa Malaysia)æœ‰å…´è¶£ï¼\n\næˆ‘ä»¬ç‰¹åˆ«ä¸ºæ•£æˆ·æŠ•èµ„è€…æ¨å‡ºAIé€‰è‚¡ç³»ç»Ÿï¼š\n\nğŸ¤– AIæ™ºèƒ½åˆ†ææŠ€æœ¯ï¼š\nâ€¢ å®æ—¶ç›‘æ§KLSE/SETè‚¡ç¥¨\nâ€¢ æŠ€æœ¯é¢+åŸºæœ¬é¢åŒé‡åˆ†æ\nâ€¢ è‡ªåŠ¨è¯†åˆ«ä¹°å…¥/å–å‡ºä¿¡å·\nâ€¢ é£é™©è¯„çº§ä¸æ­¢æŸå»ºè®®\n\nğŸ¯ ä¸“å±æ•£æˆ·åŠŸèƒ½ï¼š\nâœ… å°é¢æŠ•èµ„ç»„åˆä¼˜åŒ–\nâœ… é©¬æ¥è¥¿äºšå¸‚åœºæ·±åº¦åˆ†æ\nâœ… ä¸­æ–‡ç•Œé¢ä¸å®¢æœ\nâœ… æ¯æ—¥ç›˜å‰ç²¾é€‰æ¨è\n\nå…è´¹è¯•ç”¨7å¤©ï¼š https://example.com"
                }
            ]
        };

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            loadData();
            setupDropZone();
            setTimeout(() => showNotification('ç³»ç»Ÿå·²å°±ç»ªï¼', 'success'), 500);
        });

        // è®¾ç½®æ‹–æ”¾åŒº
        function setupDropZone() {
            const dropZone = document.getElementById('dropZone');
            
            dropZone.addEventListener('dragover', function(e) {
                e.preventDefault();
                dropZone.style.borderColor = '#4CAF50';
                dropZone.style.background = 'rgba(76, 175, 80, 0.1)';
            });
            
            dropZone.addEventListener('dragleave', function() {
                dropZone.style.borderColor = '';
                dropZone.style.background = '';
            });
            
            dropZone.addEventListener('drop', function(e) {
                e.preventDefault();
                dropZone.style.borderColor = '';
                dropZone.style.background = '';
                
                const file = e.dataTransfer.files[0];
                if (file && file.name.endsWith('.json')) {
                    readFile(file);
                } else {
                    showNotification('è¯·æ‹–æ”¾JSONæ–‡ä»¶', 'error');
                }
            });
        }

        // å¯¼å…¥æ¶ˆæ¯
        function importMessages() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            
            input.onchange = function(e) {
                const file = e.target.files[0];
                if (file) {
                    readFile(file);
                }
            };
            
            input.click();
        }

        // è¯»å–æ–‡ä»¶
        function readFile(file) {
            const reader = new FileReader();
            
            reader.onload = function(e) {
                try {
                    fileData = JSON.parse(e.target.result);
                    
                    // æ˜¾ç¤ºæ–‡ä»¶ä¿¡æ¯
                    document.getElementById('fileInfoContent').innerHTML = `
                        <div style="margin-bottom: 10px;">
                            <strong>æ–‡ä»¶å:</strong> ${file.name}
                        </div>
                        <div style="margin-bottom: 10px;">
                            <strong>å¤§å°:</strong> ${(file.size / 1024).toFixed(2)} KB
                        </div>
                        <div>
                            <strong>æ¶ˆæ¯æ•°é‡:</strong> ${fileData.messages ? fileData.messages.length : 0} æ¡
                        </div>
                    `;
                    
                    document.getElementById('fileInfo').style.display = 'block';
                    showNotification('æ–‡ä»¶è¯»å–æˆåŠŸ', 'success');
                    
                } catch (error) {
                    showNotification('æ–‡ä»¶æ ¼å¼é”™è¯¯', 'error');
                }
            };
            
            reader.readAsText(file);
        }

        // å¤„ç†ç…§ç‰‡ä¸Šä¼ 
        function handlePhotos(event) {
            const files = event.target.files;
            const previewContainer = document.getElementById('photoPreview');
            
            currentPhotos = []; // æ¸…ç©ºå½“å‰ç…§ç‰‡
            
            for (let i = 0; i < files.length; i++) {
                const file = files[i];
                const reader = new FileReader();
                
                reader.onload = function(e) {
                    const photoData = {
                        id: 'photo_' + Date.now() + '_' + i,
                        data: e.target.result,
                        name: file.name,
                        size: file.size
                    };
                    
                    currentPhotos.push(photoData);
                    
                    // åˆ›å»ºé¢„è§ˆ
                    const previewDiv = document.createElement('div');
                    previewDiv.className = 'photo-preview';
                    previewDiv.innerHTML = `
                        <img src="${e.target.result}" alt="ç…§ç‰‡é¢„è§ˆ" onclick="viewPhoto('${photoData.id}')">
                        <div class="photo-remove" onclick="removePhoto('${photoData.id}')">
                            <i class="fas fa-times"></i>
                        </div>
                    `;
                    
                    previewContainer.appendChild(previewDiv);
                };
                
                reader.readAsDataURL(file);
            }
            
            event.target.value = ''; // é‡ç½®è¾“å…¥æ¡†
        }

        // ç§»é™¤ç…§ç‰‡
        function removePhoto(photoId) {
            currentPhotos = currentPhotos.filter(p => p.id !== photoId);
            updatePhotoPreview();
        }

        // æ›´æ–°ç…§ç‰‡é¢„è§ˆ
        function updatePhotoPreview() {
            const previewContainer = document.getElementById('photoPreview');
            previewContainer.innerHTML = '';
            
            currentPhotos.forEach(photo => {
                const previewDiv = document.createElement('div');
                previewDiv.className = 'photo-preview';
                previewDiv.innerHTML = `
                    <img src="${photo.data}" alt="ç…§ç‰‡é¢„è§ˆ" onclick="viewPhoto('${photo.id}')">
                    <div class="photo-remove" onclick="removePhoto('${photo.id}')">
                        <i class="fas fa-times"></i>
                    </div>
                `;
                previewContainer.appendChild(previewDiv);
            });
        }

        // æŸ¥çœ‹ç…§ç‰‡
        function viewPhoto(photoId) {
            const photo = currentPhotos.find(p => p.id === photoId);
            if (photo) {
                document.getElementById('photoModalImg').src = photo.data;
                document.getElementById('photoModal').classList.add('active');
            }
        }

        // å…³é—­ç…§ç‰‡æŸ¥çœ‹
        function closePhotoModal() {
            document.getElementById('photoModal').classList.remove('active');
        }

        // ç¡®è®¤å¯¼å…¥
        function confirmImport() {
            if (!fileData || !fileData.messages) {
                showNotification('æ²¡æœ‰å¯å¯¼å…¥çš„æ•°æ®', 'error');
                return;
            }
            
            // åˆå¹¶æ¶ˆæ¯
            const existing = messages.messages || [];
            const newMsgs = fileData.messages;
            const existingIds = new Set(existing.map(m => m.id));
            
            // å»é‡
            const uniqueNew = newMsgs.filter(msg => !existingIds.has(msg.id));
            
            messages.messages = [...existing, ...uniqueNew];
            
            // ä¿å­˜
            localStorage.setItem('pushads_messages', JSON.stringify(messages));
            
            // æ›´æ–°ç•Œé¢
            loadTemplates();
            updateStats();
            
            showNotification(`å¯¼å…¥ ${uniqueNew.length} æ¡æ–°æ¶ˆæ¯`, 'success');
            cancelImport();
        }

        // å–æ¶ˆå¯¼å…¥
        function cancelImport() {
            document.getElementById('fileInfo').style.display = 'none';
            fileData = null;
        }

        // åŠ è½½æ•°æ®
        function loadData() {
            // åŠ è½½å®¢æˆ·
            const savedCustomers = localStorage.getItem('pushads_customers');
            if (savedCustomers) {
                try {
                    customers = JSON.parse(savedCustomers);
                } catch (e) {
                    customers = [];
                }
            }
            
            // åŠ è½½æ¶ˆæ¯
            const savedMessages = localStorage.getItem('pushads_messages');
            if (savedMessages) {
                try {
                    const parsed = JSON.parse(savedMessages);
                    if (parsed && parsed.messages) {
                        messages = parsed;
                    } else if (Array.isArray(parsed)) {
                        messages = { messages: parsed };
                    }
                } catch (e) {
                    messages = defaultMessages;
                }
            } else {
                messages = defaultMessages;
                localStorage.setItem('pushads_messages', JSON.stringify(messages));
            }
            
            loadTemplates();
            updateStats();
            renderCustomers();
        }

        // åŠ è½½æ¨¡æ¿
        function loadTemplates() {
            const category = document.getElementById('messageCategory').value;
            const select = document.getElementById('messageTemplate');
            
            select.innerHTML = '<option value="">é€‰æ‹©æ¶ˆæ¯æ¨¡æ¿</option>';
            
            if (category && messages.messages) {
                const filtered = messages.messages.filter(msg => msg.category === category);
                
                filtered.forEach(msg => {
                    const option = document.createElement('option');
                    option.value = msg.id;
                    option.textContent = msg.title;
                    select.appendChild(option);
                });
            }
            
            showPreview();
        }

        // æ˜¾ç¤ºé¢„è§ˆ
        function showPreview() {
            const id = document.getElementById('messageTemplate').value;
            const preview = document.getElementById('messagePreview');
            
            if (!id) {
                preview.textContent = 'è¯·é€‰æ‹©æ¶ˆæ¯æ¨¡æ¿æŸ¥çœ‹é¢„è§ˆ';
                return;
            }
            
            const msg = messages.messages.find(m => m.id === id);
            if (msg) {
                preview.textContent = msg.text;
            } else {
                preview.textContent = 'æ¶ˆæ¯æœªæ‰¾åˆ°';
            }
        }

        // è®¾ç½®ç±»åˆ«
        function setCategory(category) {
            currentCategory = category;
            
            // æ›´æ–°æ ‡ç­¾
            document.querySelectorAll('.category-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // æ›´æ–°æ¶ˆæ¯ç±»åˆ«é€‰æ‹©
            document.getElementById('messageCategory').value = category;
            
            loadTemplates();
            renderCustomers();
        }

        // è®¾ç½®ç­›é€‰
        function setFilter(filter) {
            currentFilter = filter;
            
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            renderCustomers();
        }

        // æ‰“å¼€æ·»åŠ æ¨¡æ€æ¡†
        function openAddModal(id = null) {
            editingId = id;
            currentPhotos = []; // æ¸…ç©ºç…§ç‰‡
            const modal = document.getElementById('addModal');
            const title = document.getElementById('modalTitle');
            
            if (id) {
                // ç¼–è¾‘æ¨¡å¼
                title.textContent = 'ç¼–è¾‘å®¢æˆ·';
                const customer = customers.find(c => c.id === id);
                if (customer) {
                    document.getElementById('customerName').value = customer.name || '';
                    document.getElementById('customerPhone').value = customer.phone || '';
                    document.getElementById('customerCategory').value = customer.category || 'general';
                    document.getElementById('customerProduct').value = customer.product || '';
                    document.getElementById('customerNotes').value = customer.notes || '';
                    
                    // åŠ è½½ç…§ç‰‡
                    if (customer.photos && customer.photos.length > 0) {
                        currentPhotos = customer.photos;
                        updatePhotoPreview();
                    }
                }
            } else {
                // æ·»åŠ æ¨¡å¼
                title.textContent = 'æ·»åŠ æ–°å®¢æˆ·';
                document.getElementById('customerName').value = '';
                document.getElementById('customerPhone').value = '';
                document.getElementById('customerCategory').value = 'general';
                document.getElementById('customerProduct').value = '';
                document.getElementById('customerNotes').value = '';
                
                // æ¸…ç©ºç…§ç‰‡é¢„è§ˆ
                document.getElementById('photoPreview').innerHTML = '';
            }
            
            modal.classList.add('active');
        }

        // å…³é—­æ¨¡æ€æ¡†
        function closeModal() {
            document.getElementById('addModal').classList.remove('active');
            editingId = null;
            currentPhotos = [];
            document.getElementById('photoPreview').innerHTML = '';
        }

        // ä¿å­˜å®¢æˆ·
        function saveCustomer(event) {
            event.preventDefault();
            
            const customerData = {
                id: editingId || 'cust_' + Date.now(),
                name: document.getElementById('customerName').value.trim(),
                phone: document.getElementById('customerPhone').value.trim(),
                category: document.getElementById('customerCategory').value,
                product: document.getElementById('customerProduct').value.trim(),
                notes: document.getElementById('customerNotes').value.trim(),
                photos: [...currentPhotos], // å¤åˆ¶ç…§ç‰‡æ•°ç»„
                dateAdded: new Date().toISOString(),
                lastUpdated: new Date().toISOString(),
                status: 'new'
            };
            
            if (editingId) {
                // æ›´æ–°
                const index = customers.findIndex(c => c.id === editingId);
                if (index !== -1) {
                    customers[index] = customerData;
                }
            } else {
                // æ·»åŠ 
                customers.push(customerData);
            }
            
            // ä¿å­˜
            localStorage.setItem('pushads_customers', JSON.stringify(customers));
            
            // æ›´æ–°ç•Œé¢
            closeModal();
            renderCustomers();
            updateStats();
            
            showNotification(editingId ? 'å®¢æˆ·å·²æ›´æ–°' : 'æ–°å®¢æˆ·å·²æ·»åŠ ', 'success');
        }

        // æ¸²æŸ“å®¢æˆ·åˆ—è¡¨
        function renderCustomers() {
            const list = document.getElementById('customerList');
            const today = new Date().toISOString().slice(0, 10);
            
            // ç­›é€‰å®¢æˆ·
            let filtered = customers.filter(customer => {
                if (customer.category !== currentCategory) return false;
                
                const phoneKey = customer.phone ? customer.phone.replace(/[^\d+]/g, '') : '';
                const isSent = phoneKey && localStorage.getItem(`sent_${phoneKey}`);
                
                if (currentFilter === 'pending') return !isSent;
                if (currentFilter === 'sent') return isSent;
                if (currentFilter === 'today') {
                    const date = customer.dateAdded || customer.createdAt;
                    return date && date.includes(today);
                }
                if (currentFilter === 'hasPhotos') {
                    return customer.photos && customer.photos.length > 0;
                }
                
                return true;
            });
            
            if (filtered.length === 0) {
                list.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">
                            <i class="fas fa-users"></i>
                        </div>
                        <div>æš‚æ— å®¢æˆ·</div>
                        <div style="margin-top: 10px; font-size: 14px;">
                            ç‚¹å‡»"æ·»åŠ å®¢æˆ·"æŒ‰é’®å¼€å§‹
                        </div>
                    </div>`;
                return;
            }
            
            list.innerHTML = filtered.map(customer => {
                const phoneKey = customer.phone ? customer.phone.replace(/[^\d+]/g, '') : '';
                const isSent = phoneKey && localStorage.getItem(`sent_${phoneKey}`);
                const initials = customer.name ? customer.name.charAt(0).toUpperCase() : '?';
                const hasPhotos = customer.photos && customer.photos.length > 0;
                const mainPhoto = hasPhotos ? customer.photos[0].data : null;
                
                return `
                    <div class="customer-card">
                        <div class="customer-header">
                            <div class="customer-avatar">
                                ${mainPhoto 
                                    ? `<img src="${mainPhoto}" class="customer-avatar-img" alt="${customer.name}">`
                                    : initials
                                }
                            </div>
                            <div class="customer-info">
                                <div class="customer-name">${customer.name || 'æœªå‘½å'}</div>
                                <div class="customer-phone">${customer.phone || 'æ— å·ç '}</div>
                                <div style="font-size: 12px; color: var(--text-light); margin-top: 5px;">
                                    ${customer.dateAdded ? customer.dateAdded.slice(0,10) : ''}
                                    ${isSent ? ' Â· å·²å‘é€' : ''}
                                    ${hasPhotos ? ' Â· <i class="fas fa-camera"></i>' : ''}
                                </div>
                            </div>
                        </div>
                        
                        <!-- ç…§ç‰‡å±•ç¤º -->
                        ${hasPhotos ? `
                            <div class="customer-photos">
                                ${customer.photos.slice(0, 3).map(photo => `
                                    <img src="${photo.data}" class="customer-photo" 
                                         onclick="viewPhoto('${photo.id}')" 
                                         alt="å®¢æˆ·ç…§ç‰‡">
                                `).join('')}
                                ${customer.photos.length > 3 ? `
                                    <div style="width: 80px; height: 80px; display: flex; align-items: center; justify-content: center; background: var(--light); border-radius: 8px; font-size: 14px; color: var(--text-light);">
                                        +${customer.photos.length - 3}å¼ 
                                    </div>
                                ` : ''}
                            </div>
                        ` : ''}
                        
                        ${customer.product ? `
                            <div class="customer-notes">
                                <strong>æ„Ÿå…´è¶£:</strong> ${customer.product}
                            </div>
                        ` : ''}
                        
                        ${customer.notes ? `
                            <div class="customer-notes">
                                ${customer.notes}
                            </div>
                        ` : ''}
                        
                        <div class="customer-actions">
                            ${phoneKey && !isSent ? `
                                <button class="action-btn send-btn" onclick="sendToCustomer('${customer.id}')">
                                    <i class="fab fa-whatsapp"></i> å‘é€
                                </button>
                            ` : `
                                <button class="action-btn" style="background: var(--light); color: var(--text);" ${!isSent ? 'disabled' : ''}>
                                    ${isSent ? '<i class="fas fa-check"></i> å·²å‘é€' : 'æ— å·ç '}
                                </button>
                            `}
                            
                            <button class="action-btn edit-btn" onclick="editCustomer('${customer.id}')">
                                <i class="fas fa-edit"></i> ç¼–è¾‘
                            </button>
                            
                            <button class="action-btn delete-btn" onclick="deleteCustomer('${customer.id}')">
                                <i class="fas fa-trash"></i> åˆ é™¤
                            </button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // ç¼–è¾‘å®¢æˆ·
        function editCustomer(id) {
            openAddModal(id);
        }

        // åˆ é™¤å®¢æˆ·
        function deleteCustomer(id) {
            if (!confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªå®¢æˆ·å—ï¼Ÿ')) {
                return;
            }
            
            customers = customers.filter(c => c.id !== id);
            localStorage.setItem('pushads_customers', JSON.stringify(customers));
            
            renderCustomers();
            updateStats();
            showNotification('å®¢æˆ·å·²åˆ é™¤', 'success');
        }

        // è·å–é€‰æ‹©çš„æ¶ˆæ¯
        function getSelectedMessage() {
            const id = document.getElementById('messageTemplate').value;
            if (!id) return null;
            
            return messages.messages.find(m => m.id === id);
        }

        // å‘é€ç»™æ‰€æœ‰å®¢æˆ·
        function sendToAll() {
            const message = getSelectedMessage();
            if (!message) {
                showNotification('è¯·å…ˆé€‰æ‹©æ¶ˆæ¯æ¨¡æ¿', 'error');
                return;
            }
            
            const pending = customers.filter(c => {
                if (c.category !== currentCategory) return false;
                const phoneKey = c.phone ? c.phone.replace(/[^\d+]/g, '') : '';
                return phoneKey && !localStorage.getItem(`sent_${phoneKey}`);
            });
            
            if (pending.length === 0) {
                showNotification('æ²¡æœ‰å¾…å‘é€çš„å®¢æˆ·', 'warning');
                return;
            }
            
            if (!confirm(`å‘é€ç»™ ${pending.length} ä¸ªå®¢æˆ·ï¼Ÿ`)) {
                return;
            }
            
            pending.forEach(customer => {
                sendMessage(customer, message, false);
            });
            
            setTimeout(() => {
                renderCustomers();
                updateStats();
                showNotification(`å·²å‘é€ç»™ ${pending.length} ä¸ªå®¢æˆ·`, 'success');
            }, 500);
        }

        // æµ‹è¯•å‘é€
        function testMessage() {
            const message = getSelectedMessage();
            if (!message) {
                showNotification('è¯·å…ˆé€‰æ‹©æ¶ˆæ¯æ¨¡æ¿', 'error');
                return;
            }
            
            const phone = prompt('è¾“å…¥æµ‹è¯•ç”µè¯å·ç ï¼ˆ+60å¼€å¤´ï¼‰ï¼š');
            if (!phone) return;
            
            const testCustomer = {
                name: 'æµ‹è¯•å®¢æˆ·',
                phone: phone,
                product: 'æµ‹è¯•äº§å“'
            };
            
            sendMessage(testCustomer, message, true);
        }

        // å‘é€æ¶ˆæ¯
        function sendMessage(customer, message, isTest = false) {
            if (!customer || !customer.phone) {
                if (!isTest) showNotification('å®¢æˆ·æ— ç”µè¯å·ç ', 'error');
                return;
            }
            
            let text = message.text;
            if (customer.name) {
                text = text.replace(/\[å§“å\]/g, customer.name);
            }
            if (customer.product) {
                text = text.replace(/\[ç”¢å“\]/g, customer.product);
                text = text.replace(/\[äº§å“å\]/g, customer.product);
            }
            
            const phoneKey = customer.phone.replace(/[^\d+]/g, '');
            const waLink = `https://wa.me/${phoneKey}?text=${encodeURIComponent(text)}`;
            
            if (!isTest) {
                localStorage.setItem(`sent_${phoneKey}`, new Date().toISOString());
                
                const today = new Date().toISOString().slice(0, 10);
                const todayCount = parseInt(localStorage.getItem(`sentToday_${today}`)) || 0;
                localStorage.setItem(`sentToday_${today}`, todayCount + 1);
            }
            
            window.open(waLink, '_blank');
            
            if (isTest) {
                showNotification('æµ‹è¯•æ¶ˆæ¯å·²å‡†å¤‡å‘é€', 'success');
            }
        }

        // å‘é€ç»™å•ä¸ªå®¢æˆ·
        function sendToCustomer(customerId) {
            const customer = customers.find(c => c.id === customerId);
            if (!customer) return;
            
            const message = getSelectedMessage();
            if (!message) {
                showNotification('è¯·å…ˆé€‰æ‹©æ¶ˆæ¯æ¨¡æ¿', 'error');
                return;
            }
            
            sendMessage(customer, message, false);
            
            setTimeout(() => {
                renderCustomers();
                updateStats();
                showNotification('æ¶ˆæ¯å·²å‘é€', 'success');
            }, 500);
        }

        // æ›´æ–°ç»Ÿè®¡
        function updateStats() {
            const today = new Date().toISOString().slice(0, 10);
            const sentToday = parseInt(localStorage.getItem(`sentToday_${today}`)) || 0;
            
            // æ€»å®¢æˆ·
            document.getElementById('totalCustomers').textContent = customers.length;
            
            // å¾…å‘é€
            const pending = customers.filter(c => {
                const phoneKey = c.phone ? c.phone.replace(/[^\d+]/g, '') : '';
                return phoneKey && !localStorage.getItem(`sent_${phoneKey}`);
            }).length;
            
            document.getElementById('pendingCustomers').textContent = pending;
            document.getElementById('sentToday').textContent = sentToday;
            
            // æ¶ˆæ¯æ¨¡æ¿
            const msgCount = messages.messages ? messages.messages.length : 0;
            document.getElementById('totalMessages').textContent = msgCount;
        }

        // æ˜¾ç¤ºæ ‡ç­¾é¡µ
        function showTab(tab) {
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            event.target.closest('.nav-item').classList.add('active');
            
            if (tab === 'customers' || tab === 'messages' || tab === 'stats') {
                showNotification('åŠŸèƒ½å¼€å‘ä¸­...', 'info');
            }
        }

        // å¯¼å‡ºæ•°æ®
        function exportData() {
            // å¯¼å‡ºæ—¶ç…§ç‰‡æ•°æ®å¯èƒ½å¾ˆå¤§ï¼Œæç¤ºç”¨æˆ·
            if (!confirm('å¯¼å‡ºæ•°æ®åŒ…å«ç…§ç‰‡ï¼Œæ–‡ä»¶å¯èƒ½è¾ƒå¤§ï¼Œç¡®å®šè¦ç»§ç»­å—ï¼Ÿ')) {
                return;
            }
            
            const exportData = {
                customers: customers,
                messages: messages,
                exportDate: new Date().toISOString()
            };
            
            const dataStr = JSON.stringify(exportData, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,' + encodeURIComponent(dataStr);
            const fileName = `pushads_${new Date().toISOString().slice(0,10)}.json`;
            
            const link = document.createElement('a');
            link.setAttribute('href', dataUri);
            link.setAttribute('download', fileName);
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            showNotification('æ•°æ®å¯¼å‡ºæˆåŠŸ', 'success');
        }

        // æ˜¾ç¤ºé€šçŸ¥
        function showNotification(message, type = 'success') {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            
            const icon = type === 'success' ? 'check-circle' : 
                        type === 'error' ? 'exclamation-circle' : 'info-circle';
            
            notification.innerHTML = `<i class="fas fa-${icon}"></i> ${message}`;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }
    </script>
</body>
</html>